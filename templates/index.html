<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Freight Estimator</title>
    <link rel="stylesheet" href="/static/style.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-sA+zNcdN2F5SEt03/f0N1TqJhCLRX+tFZLkTTVd6ER0=" crossorigin="" />
</head>
<body>
    <div class="container">
        <h1>Freight Estimator</h1>
        <form method="post">
            <label>Type:</label>
            <select name="type" onchange="this.form.submit()">
                {% for t in types %}
                <option value="{{ t }}" {% if t == selected_type %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            </select>

            <label>Origin:</label>
            <select name="origin">
                {% for o in origins %}
                <option value="{{ o }}" {% if o == selected_origin %}selected{% endif %}>{{ o }}</option>
                {% endfor %}
            </select>

            <label>Destination (Quoted Lane):</label>
            <select name="destination">
                <option value="">-- Select --</option>
                {% for d in destinations %}
                <option value="{{ d }}" {% if d == selected_destination %}selected{% endif %}>{{ d }}</option>
                {% endfor %}
            </select>

            <label>Or enter a new destination city:</label>
            <input type="text" name="new_destination" placeholder="e.g., Austin, TX" value="{{ new_destination or '' }}">

            <button type="submit">Estimate</button>
        </form>

        {% if quote %}
        <div class="quote-box">
            <h2>Quoted</h2>
            <p><strong>Total:</strong> ${{ "{:,.2f}".format(quote) }}</p>
        </div>
        {% endif %}

        {% if origin_coords and dest_coords %}
        <div id="map" style="height: 400px; margin-top: 20px;"></div>
        {% endif %}
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-Cg+9sZrgFtDJhrx6FeA+uVcyWvhQktEfJGhRkFlbRuM=" crossorigin=""></script>

    {% if origin_coords and dest_coords %}
    <script>
        const origin = {{ origin_coords|tojson }};
        const destination = {{ dest_coords|tojson }};

        const map = L.map('map').setView(origin, 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
        }).addTo(map);

        const originMarker = L.marker(origin).addTo(map).bindPopup("Origin").openPopup();
        const destMarker = L.marker(destination).addTo(map).bindPopup("Destination");

        const route = L.polyline([origin, destination], { color: 'blue' }).addTo(map);
        map.fitBounds(route.getBounds());
    </script>
    {% endif %}
</body>
</html>
